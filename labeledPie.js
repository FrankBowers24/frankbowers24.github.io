var d3;!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():t.LabeledPie=e()}(this,function(){var t=function(e){function r(t){return[t.x,t.y]}function n(t,e,n){var i,s,a,c,o,h=n-e;u.select(".lines").selectAll("polyline").each(function(e,r){r===t&&(o=this)}),i=o.points,s=r(i.getItem(0)),a=r(i.getItem(1)),c=r(i.getItem(2)),d3.select(o).transition().duration(500).attrTween("points",function(){return function(t){return a[1]=e+t*h,c[1]=e+t*h,[s,a,c]}})}function i(t,e){var r=t.transform.baseVal.getItem(0).matrix,n=r.f,i=[r.e,r.f],s=e-n;d3.select(t).transition().duration(500).attrTween("transform",function(){return function(t){return i[1]=n+t*s,"translate("+i+")"}})}function s(t){for(var e,r,s=1/0,a=0;a<t.length;a++){e=t[a].transform.baseVal.getItem(0).matrix,r=e.f;var u=t[a].getBBox().height;r>s-u&&(r=s-u,i(t[a],r),n(+t[a].dataset.index,e.f,r)),s=r}}function a(){var t=[],e=[];u.select(".labels").selectAll("text").each(function(r,n){var i=this.style.cssText;i&&!i.match("opacity: 0")&&(this.dataset.index=n,i.match("text-anchor: end")?t.push(this):e.push(this))});try{s(t),s(e.reverse())}catch(r){}return!0}var u=d3.select(e).append("svg").append("g");this.svg=u,this.svgWidth=450,this.svgHeight=190,d3.select(e).select("svg").attr("width",this.svgWidth).attr("height",this.svgHeight),this.svg.append("g").attr("class","slices"),this.svg.append("g").attr("class","labels"),this.svg.append("g").attr("class","innerLabels"),this.svg.append("g").attr("class","lines"),this.width=160,this.height=160,this.radius=Math.min(this.width,this.height)/2,this.pie=d3.layout.pie().sort(null),this.arc=d3.svg.arc().outerRadius(.8*this.radius).innerRadius(.4*this.radius),this.outerArc=d3.svg.arc().innerRadius(.85*this.radius).outerRadius(.85*this.radius),this.edgeArc=d3.svg.arc().innerRadius(.8*this.radius).outerRadius(.8*this.radius),this.minimumDisplayedPercentage=6,this.svg.attr("transform","translate("+this.svgWidth/2+","+this.svgHeight/2+")"),this.minimumDisplayedLabel=3,t.prototype.setLabels=function(t){this.labels=t},t.prototype.setColorScale=function(t){this.color=t},t.prototype.change=function(t){function e(t){return Math.round(t.value/p*100)}function r(t){return t.startAngle+(t.endAngle-t.startAngle)/2}var n=this.radius,i=this.labels,s=this.minimumDisplayedPercentage,u=this.arc,c=this.outerArc,o=this.edgeArc,h=this.svg,l=this.pie,d=this.color,f=this.minimumDisplayedLabel,p=d3.sum(t),v=h.select(".slices").selectAll("path.slice").data(l(t));v.enter().insert("path").style("fill",function(t,e){return d(e)}).attr("class","slice"),v.transition().duration(1e3).attrTween("d",function(t){this._current=this._current||t;var e=d3.interpolate(this._current,t);return this._current=e(0),function(t){return u(e(t))}}),v.exit().remove();var g=h.select(".labels").selectAll("text").data(l(t));g.enter().append("text").attr("dy",".35em").text(function(t,e){return i[e]}),g.transition().duration(1e3).style("opacity",function(t){return e(t)<f?0:1}).attrTween("transform",function(t){this._current=this._current||t;var e=d3.interpolate(this._current,t);return this._current=e(0),function(t){var i=e(t),s=c.centroid(i);return s[0]=n*(r(i)<Math.PI?1:-1),"translate("+s+")"}}).styleTween("text-anchor",function(t){this._current=this._current||t;var e=d3.interpolate(this._current,t);return this._current=e(0),function(t){var n=e(t);return r(n)<Math.PI?"start":"end"}}),g.exit().remove(),d3.timer(a,1e3);var m=h.select(".lines").selectAll("polyline").data(l(t));m.enter().append("polyline"),m.transition().duration(1e3).style("opacity",function(t){return e(t)<f?0:.3}).attrTween("points",function(t){this._current=this._current||t;var e=d3.interpolate(this._current,t);return this._current=e(0),function(t){var i=e(t),s=c.centroid(i);return s[0]=.95*n*(r(i)<Math.PI?1:-1),[o.centroid(i),c.centroid(i),s]}}),m.exit().remove();var y=h.select(".innerLabels").selectAll("text").data(l(t));y.enter().insert("text").attr("dy",".35em"),y.transition().duration(1e3).text(function(t){var r=e(t);return r>s?Math.round(r)+"%":""}).style("opacity",function(t){return t.value/p*100>s?1:0}).attrTween("transform",function(t){var e=this.getBBox();this._current=this._current||t;var r=d3.interpolate(this._current,t);return this._current=r(0),function(t){var n=r(t),i=u.centroid(n);return i[0]=i[0]-e.width/2,"translate("+i+")"}}),y.exit().remove()}};return t});